<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stock game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .stock {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
        }
        button {
            margin: 5px;
            padding: 5px 10px;
        }
        #portfolio {
            margin-top: 20px;
            font-weight: bold;
        }
        canvas {
            width: 100%;
            height: 200px;
            border: 1px solid #ddd;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>stock</h1>
    <div id="money">money: $1000</div>
    <div id="stock1" class="stock">
        <h2>meatstop</h2>
        <div>price: $<span id="price1">100</span></div>
        <div>owned: <span id="owned1">0</span></div>
        <button onclick="buyStock(1,1)">buy</button>
        <button onclick="sellStock(1,1)">sell</button>
        <button onclick="buyStock(1,Math.floor(money/stocks[0].price))">buy all</button>
        <button onclick="sellStock(1,stocks[0].owned)">sell all</button>
    </div>
    <div id="stock2" class="stock">
        <h2>hard slime cafe</h2>
        <div>price: $<span id="price2">50</span></div>
        <div>owned: <span id="owned2">0</span></div>
        <button onclick="buyStock(2,1)">buy</button>
        <button onclick="sellStock(2,1)">sell</button>
        <button onclick="buyStock(2,Math.floor(money/stocks[1].price))">buy all</button>
        <button onclick="sellStock(2,Math.floor(stocks[1].owned))">sell all</button>
       
    </div>
    <div id="stock3" class="stock">
      <h2>du pont academy</h2>
      <div>Price: $<span id="price3">50</span></div>
      <div>Owned: <span id="owned3">0</span></div>
      <button onclick="buyStock(3,1)">buy</button>
      <button onclick="sellStock(3,1)">sell</button>
      <button onclick="buyStock(3,Math.floor(money/stocks[2].price))">buy all</button>
      <button onclick="sellStock(3,stocks[2].owned)">sell all</button>
    </div>
    <div id="portfolio">total value: $1000</div>
    <canvas id="stockGraph"></canvas>
    <script>
        var money = 1000;
        var crashBoomHistory = 0;
        var loaded = false;
        var stocks = [
            { name: "meatstop", price: 100, owned: 0, history: [], crashBoomHistory: 0},
            { name: "hard slime cafe", price: 50, owned: 0, history: [], crashBoomHistory: 0},
            { name: "du pont academy", price: 50, owned: 0, history: [], crashBoomHistory: 0}
        ];

        const canvas = document.getElementById('stockGraph');
        const ctx = canvas.getContext('2d');
        const graphWidth = canvas.width;
        const graphHeight = canvas.height;

        function updateDisplay() {
            

            document.getElementById('money').textContent = 'money: $' + money.toFixed(2).toString();
            
            stocks.forEach((stock, index) => {
                document.getElementById(`price${index + 1}`).textContent = stock.price.toFixed(2);
                document.getElementById(`owned${index + 1}`).textContent = stock.owned;
            });
            const portfolioValue = money + stocks.reduce((total, stock) => total + stock.price * stock.owned, 0);
            document.getElementById('portfolio').textContent = `total portfolio value: $${portfolioValue.toFixed(2)}`;
            
        }

        function buyStock(stockId, amount) {
            const stock = stocks[stockId - 1];
            if (money >= stock.price*amount) {
                money -= stock.price*amount;
                stock.owned+= amount;

                updateDisplay();
            } else {
                alert('not enough money to buy stock');
            }
            
        }

        function sellStock(stockId,amount) {
            const stock = stocks[stockId - 1];
            if (stock.owned >= amount) {
                money += stock.price*amount;
                stock.owned-=amount;
                updateDisplay();
            } else {
                alert("you don't have any of this stock to sell");
            }
        }

        function updateStockPrices() {
            var x = Date.now() / 10000000;
            
            stocks.forEach(stock => {
                
                const change =  ((Math.random() - 0.5) * Math.sin(x) * 20 + 
                                (Math.random() - 0.5) *  Math.sin(x*2)*20 +
                                 Math.abs(Math.cos(x*13)*2) + 0.75)/3; //+ (Math.random()-1.1)*5 + Math.random()*(3.75-2)+2)/2;
                  
                if (Math.random() < 0.1) {
                    if (stock.crashBoomHistory>1){
                        stock.crashBoomHistory = -0.1;
                    }else if(crashBoomHistory<-1) {
                        stock.crashBoomHistory = 0.1;
                    }
                    // decide whether to crash or boom
                    if ((Math.random() + stock.crashBoomHistory) < 0.5) {
                        // crash
                        const crashFactor = 0.8 + Math.random() * 0.1;
                        stock.price *= crashFactor;
                        stock.crashBoomHistory-=0.2;
                    } else {
                        // boom
                        const boomFactor = 1.1 + Math.random() * 0.1;
                        stock.price *= boomFactor;
                        stock.crashBoomHistory+=0.2;
                    }
                } 
                    stock.price = Math.max(1, stock.price + change);
                    stock.history.push(stock.price);
                    if (stock.history.length > 50) stock.history.shift();

                
            });
            
            updateDisplay();
            drawGraph();
        }

        function drawGraph() {
            
            ctx.clearRect(0, 0, graphWidth, graphHeight);
            
            const colors = ['red', 'green', 'aqua'];
            const maxPrice = Math.max(...stocks.flatMap(stock => stock.history));
            const minPrice = Math.min(...stocks.flatMap(stock => stock.history));
            const scaleY = (graphHeight / maxPrice);

            stocks.forEach((stock, stockIndex) => {
                ctx.strokeStyle = colors[stockIndex];
                ctx.beginPath();
                stock.history.forEach((price, index) => {
                    const x = (index / 50) * graphWidth;
                    const y = graphHeight - price * scaleY;
                    if (index == 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.stroke();
            });

            ctx.font = '12px Arial';
            stocks.forEach((stock, index) => {
                ctx.fillStyle = colors[index];
                ctx.fillText(stock.name, 10, 20 + index * 20);
            });
        }
        
        setInterval(updateStockPrices, 500);
        updateDisplay();
        
    </script>
</body>
</html>